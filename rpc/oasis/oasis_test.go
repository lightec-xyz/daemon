package oasis

import (
	"testing"

	"github.com/ethereum/go-ethereum/common/hexutil"
)

var err error
var client *Client

func init() {
	client, err = NewClient("https://testnet.sapphire.oasis.io",
		"0xd53859C586D0593343842e75E358d5f9E1ca26CE",
	)
	if err != nil {
		panic(err)
	}
}

func TestClient_PublicKey(t *testing.T) {
	publicKey, err := client.PublicKey()
	if err != nil {
		t.Fatal(err)
	}
	for _, item := range publicKey {
		t.Logf("%v\n", hexutil.Encode(item))
	}
}

func TestClient_SignBtcTx(t *testing.T) {
	// https://holesky.etherscan.io/tx/0x3db1bb46352898a1ff0349274d0dcc7c8e78020ab2268c2bfa0863ab0e9de001

	//    ethereum_test.go:41
	txRaw, err := hexutil.Decode("0x02f90113824268808459682f0085013347545283068a10944f413972ab2d4e53714a479db1519ce0e89ea30c80b8a40449015a0000000000000000000000000000000000000000000000000000000000002ee0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000016001464d468d12f61295882b0f8f63c64b58e2af058e400000000000000000000c080a00d93677b3014c8657e6a6ad4cbf280915c4f77ff83bead44f5aad4855d7c8faaa0519a9544947112c6b8ece48404ee8e4b068669a251af5aa71e936fc88e0745bc")
	if err != nil {
		t.Fatal(err)
	}

	//    ethereum_test.go:42
	receiptRaw, err := hexutil.Decode("0x02f9046101830ac170b9010000000000140000000000000000000000000000000000000000000000000000001000000000000000000400000000000000000000000000000000000000020800000000080000000000000008000000000000000000000000000000000000000000000000820000000000008000000800000000000000000000000010000000000000000000000000000000000000000040000000000000000000000000000400000000000000000000000080000000000000000000000000010000040000000240000002000000000000000000000000000000000000000120000400000020000000000000000000000000000000000000000040000000800000000000000000f90356f89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f6cdfeb7ae943d6d5879c9c9dce84b51f94b9985a00000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000030e0f89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000003fe784e30d12078391a01da98709ddd00d9797a00000000000000000000000000000000000000000000000000000000000000060f89b940ebe0e56b6b106763bbed1da30a4d6fc6064eadaf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000f6cdfeb7ae943d6d5879c9c9dce84b51f94b9985a0000000000000000000000000000000000000000000000000000006fc23ac0000f9017c944f413972ab2d4e53714a479db1519ce0e89ea30cf842a01e5e2baa6d11cc5bcae8c0d1187d7b9ebf13d6d9b932f7dbbf4e396438845fb8a044f51ce1115129a44b62467420659e77d1ce7f7ff3190059849951d55c749981b90120000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000007d0200000001b095e7df80a9e758ae67fa9c7d9b8c5464dc41249fffe9b164d4be56b404dfcc0000000000ffffffff02802e00000000000016001464d468d12f61295882b0f8f63c64b58e2af058e4401d0000000000002200207c907704071d036924b69db3b98b683cc405384828b55b1b3d25ffd8d04381bf000000000000000000000000000000000000000000000000000000000000000000000000000001e83a658f2560e61511f20decdf860f61066ba130ced55c7e732a6233d15137a2")
	if err != nil {
		t.Fatal(err)
	}

	proofData, err := hexutil.Decode("0x1ce267b765622fd935b8a235f89e1e712d5a032767b708e9497d4bad00975b13084b99accd682f8ef29cf8b4fcdd2a573e80134a742f03b11a0f3e5c5a6819012d4ce1ca82349da04ee79a3ed16d39ae9c1bd0c17b26cc358dea0432f5fbf18a300b6ff14510724ec7a8ff619ebeeabd5d568781309749026f99b96ee620ff0d1e8259019a39a8d5e85ba57506ab2eb34e4bab12dc7a1c393779b987f30d44b416cf3ba55a4a2a6fb83e5ed2922c36f9e4623464f2108fab0c650258ea7d241f020f33cec0c5d2193bf00857cc2affc683e33bc0cdb0aec294f4f94294f259302161de6187354bb481518da0aff90ed02235a9f2ebaf551d1bed692e347608342473cad178d72c403b96c47c09337f23989e7dd053616790cee3e159b248a86d09048e0ef435c3d94406ff71711c64bb3c70e6e2bbe5ec25768d2d921cbbbadb2199f809800e1d2214d3997db33a04f6acf08fc3bdb634ed48b7eb72ebf8170f2118d17934ef4648526d7e8e823d41788be0114af669e7454303bd7e3e066abd21e8f386ef2e6a2150111950e032c554099d5a481ab14577edb17800282a1341116d788c52bffad64e705c18769a1d96bbe496cf6da42fff31156b0968d641f50dd912b1f58324404818bf48999b0157b5d3628d6607e8645cb00ddab6a779fc00d438a65146c9c30f695928f1550ddc5b7e95a806a168bc88bf329f96bf11cf217d22b4665cf2d2317104d773a74b105fff69871d689ff33bc9ddf0e7e1b28b12372861a00e2fcbf553011c60fef30537e0a8101917f7d17c9466cdfd018661156f1a3de4e1cd540727b36dfc76b87e611bf4439ba725591a6d6053f194d743173e4e2b6fe1f26799557d9c215be013709cb35e49e3d92afdb5d8459bd847d50e2db74d10da1847dab37d21388d56952b81fe20a80a27989936f9d2bc843af811ffff807b3f04da9255e794d85cc0f51e31bae25f72aa3b1976eb31cdcce0c4138c7cab19f2e2e01eb982d562dbf9891ae5d31b95b47962046a01dc8a8e6a8616fe8d721d62427f4a7f44a664853db4565fe11871f776c55351a30440178bfd0176553318445a77cdaedf65eb24ee79ab0bffcd5f3508d13b06f6d30eb52e8c295471a8f6ba1f66238b76958d27510119196906853cb50889e33d9ae975336c2a817104b1c294d5000966c3a0b94a646077852e2f82aa1d6a66d033d77488f31b8b3f56df6bba1b3048dd4a5e84a07b5f34a9e98678f8962edaa8a12cf76d2306ac03832fb3632039c7fd83791a5a06cdd9455f72c3f6340b7569ed5f6b868f")
	if err != nil {
		t.Fatal(err)
	}

	sigs, err := client.SignBtcTx(txRaw, receiptRaw, proofData)
	if err != nil {
		t.Fatal(err)
	}

	t.Logf("%x\n", sigs)
}
