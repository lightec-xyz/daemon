package oasis

import (
	"testing"

	"github.com/ethereum/go-ethereum/common/hexutil"
)

var err error
var client *Client

func init() {
	client, err = NewClient("https://testnet.sapphire.oasis.io",
		"0x7ccCc552F55C05FD33d9827070E1dB3D28322622",
	)
	if err != nil {
		panic(err)
	}
}

func TestClient_PublicKey(t *testing.T) {
	/*
		    oasis_test.go:27: 0x034def276d763bfb937a4f356d26b58cb0428bc198d000b91630db5d04bb7f35dc
			oasis_test.go:27: 0x03183ee062dafa5a0e536ba497c6375a996364682bf22cd5de989df1b0b9d23621
		    oasis_test.go:27: 0x03a868050ec7b61b6956d6c1ca722f4d2a32671902486980d5fd6ebf9b4c64dd93
	*/
	publicKey, err := client.PublicKey()
	if err != nil {
		t.Fatal(err)
	}
	for _, item := range publicKey {
		t.Logf("%v\n", hexutil.Encode(item))
	}
}

func TestClient_SignBtcTx(t *testing.T) {
	// https://holesky.etherscan.io/tx/0xeaf28c6b4837a7f21db7854fae273a6f33e81b3560539f0e0814072b69a25981

	//    ethereum_test.go:41
	txRaw, err := hexutil.Decode("0x02f901138242682c84036803de85014cf7d5d28306690f94b2631368c8c8151875ea67cb5faf8f1377ec02a080b8a474f4897c0000000000000000000000000000000000000000000000000000000000004e20000000000000000000000000000000000000000000000000000000000000a99f000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000160014a8a337fbfd692a5628e96d44684b9ee35d9e913e00000000000000000000c001a022e3b3fadfcc68571ccc449f0bf6d122bba34e7e5b70ee73254c3625bd45c501a001b0e5c78392f4c6ee42091e88b27eecfcd8df4e80be8271246fd86bcbd61747")
	if err != nil {
		t.Fatal(err)
	}

	//    ethereum_test.go:42
	receiptRaw, err := hexutil.Decode("0x02f90462018401b7598fb9010000000000140000000000000000000000000000000000000000000000000000041000000000000000000000000000000000000000000000000000000200020800000000000000000000000008000000000000000000000000000000000000000000000000028000000000000000000800000000000000000000000010000000000000000000000000000000010000000000000000000000020000000000000400000000000000020000000080000000000040000000000000010000000008000240000002000000000000000000000000000000000000000000000000000020000000000000000000000000000200000000000040000000800000000000000000f90356f89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000005eed85149d7c3d74d28c9b164b210a20e749199ca00000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000f7bff89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000003fe784e30d12078391a01da98709ddd00d9797a000000000000000000000000000000000000000000000000000000000000000a0f89b940ebe0e56b6b106763bbed1da30a4d6fc6064eadaf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000005eed85149d7c3d74d28c9b164b210a20e749199ca000000000000000000000000000000000000000000000000000000ba43b740000f9017c94b2631368c8c8151875ea67cb5faf8f1377ec02a0f842a01e5e2baa6d11cc5bcae8c0d1187d7b9ebf13d6d9b932f7dbbf4e396438845fb8a0d65f9c6c2944bb141d27715b6ee4964ca779df68000fd9935b69b82e62124780b90120000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000007d020000000189f0b8cdd377fd39fb0d46991bec900496b5832914edbc68ff93446388d435920000000000ffffffff02804d000000000000160014a8a337fbfd692a5628e96d44684b9ee35d9e913e61a9060000000000220020957ab85b710cb5b577171e23bb3492536c8029cc99511f3920d3cc13871a2327000000000000000000000000000000000000000000000000000000000000000000000000000001ee0eeeacc0b3a7c5b5e885965d402f8a5ce1b427f13df45ae25ff3967c35bd00")
	if err != nil {
		t.Fatal(err)
	}

	proofData, err := hexutil.Decode("0x1f04cbbdb0b9b5ce8f3ad1c2793d7a67948a2b4ae3535f0cd5d3944a48e6acdf2b9fa80df6ce67d427e7ea40a95b3c8a8c864473e4e5b8848ef7f03c17f0d84f23ce8f7be47eac51de964d9041ed2652417fef8163e1a51d2b0b42282215659410583afd536e9fab140105b62cbca18e203a14a44dff3321db424829bf4acdb61a8279b89e4d034057aede22e0edfe85774586d0b594a92ea380af78b312c6570353211387a64fc29dd9bf2615717cd9b023937c46e8ab940c20df00605c0c6e005162188a1c5dacdf9bd264081ffd1e9676c4cff0c7a1fb1e9d964318f1128f0bb210c20ff5d8737b298cd851b10edce643dc2162dd9fc9582d9231ddf1380401ae0408857cdd004bfd1852dca7e61056f319163ab7a8d929263b54647a16a6173e1e8690a661f0db283987fc9b407ddb74f59cb134e312a49887c13fb35d0b1ed1ba1a10e38b9bbd6b4cbcd603a5c4c953b454e5dd6bd098444b44f59f751b25fb43bcce2632febe33de4ccbc26056e900882f13da9265051e054f39fe11092541d555f6875880ae1cc0d962c7eeb6de40e1e1114fe3b862b153c8de2ff93b24b2c2162ad53a18b6fffaa3d14bfd9b893f8e99a7d6809ec12e92707b5fe95806ba799ee320ac27772c843290d7906fe8ac0f1310813b23646436645edfcad71000e66f8c2ec00a352de464644a406b1ffaa4390bd150d684ffceb2d91c91a70cb4473f08c055247891dcabacda99fcfbb5be52811be3341e46bcc62ca3b0e1267899ce80bf16515eb9830656e1379e1c0237be4821964045af32a36b5885f520310777d1ed2469e6bc5737118fb97693ec9ea3fce866942e973e47aae7feaa020d112f902f1660d3a406049ff80ee559f9de946a46b5c9fe4c2ae85bbbe8d60c7e09169045371f9ad8a8fcc731cfc58eedeaf3ce67e83f213a4a1a720801c80c64a402c830c5b0c1c0faf445187e41dc77eba04e316e0b169f782c81d42651169eced5bae099648c4742f1b31c44e543264bd98baeb741532f5a9b1de3233d04aa027486dcaa7cc2b3d801d4a6ed0f871d7b96be801fea3729d939b1c135b60f0d0f79105697a20bfaff163b1747ff2d0c9f7f2d01672a780a454bf95da3e8216a7baf840efca56473d329724f61d04bebbff5d4cc6da93d71c4ba7478dccc1f8b303adf36095f5c59165a25b0ab58862daf24535e62e4b8aae58b4c9e75d81bb680c5afe3f5a3cf28f3856a38a3a0c537db1bb79e3af2d99537e4816ad77912e7f95acf842a748fca73fa1e898c77664a3f032509e5e03ab812dcba70b7c0")
	if err != nil {
		t.Fatal(err)
	}

	sigs, err := client.SignBtcTx(txRaw, receiptRaw, proofData)
	if err != nil {
		t.Fatal(err)
	}

	t.Logf("%x\n", sigs)
}
