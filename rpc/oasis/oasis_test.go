package oasis

import (
	"testing"

	"github.com/ethereum/go-ethereum/common/hexutil"
)

var err error
var client *Client

func init() {
	client, err = NewClient("https://testnet.sapphire.oasis.io",
		"0x7ccCc552F55C05FD33d9827070E1dB3D28322622",
	)
	if err != nil {
		panic(err)
	}
}

func TestClient_PublicKey(t *testing.T) {
	/*
		    oasis_test.go:27: 0x034def276d763bfb937a4f356d26b58cb0428bc198d000b91630db5d04bb7f35dc
			oasis_test.go:27: 0x03183ee062dafa5a0e536ba497c6375a996364682bf22cd5de989df1b0b9d23621
		    oasis_test.go:27: 0x03a868050ec7b61b6956d6c1ca722f4d2a32671902486980d5fd6ebf9b4c64dd93
	*/
	publicKey, err := client.PublicKey()
	if err != nil {
		t.Fatal(err)
	}
	for _, item := range publicKey {
		t.Logf("%v\n", hexutil.Encode(item))
	}
}

func TestClient_SignBtcTx(t *testing.T) {
	// https://holesky.etherscan.io/tx/0x3db1bb46352898a1ff0349274d0dcc7c8e78020ab2268c2bfa0863ab0e9de001

	//    ethereum_test.go:41
	txRaw, err := hexutil.Decode("0x02f9011282426808843b9aca00843b9aca2883066bf59419d376e6a10aad92e787288464d4c738de97d13580b8a474f4897c0000000000000000000000000000000000000000000000000000000000002ee000000000000000000000000000000000000000000000000000000000000001f6000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000160014a8a337fbfd692a5628e96d44684b9ee35d9e913e00000000000000000000c080a02575789ec4490eb510c52a006e13765c5703ccb309220e73708ed64a241ea9fea0152d238d34be278cca3f7d39853b2209c19f50b2dc211cd77897131025df7afa")
	if err != nil {
		t.Fatal(err)
	}

	//    ethereum_test.go:42
	receiptRaw, err := hexutil.Decode("0x02f9046101835a3b4eb9010000000000140000000000000000000000000000000000000000000000000000001040000000000000000000000000000000000000000000000000000200020800000000000000000000000008000000000000000000000000000000000000000000000000028000000000000020000800000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000080000000000040000000000000010000000000000240000002000000000000000000000000000000000100000000000100000020000000000000000000000020000000000000000040000001800000000000000000f90356f89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000005eed85149d7c3d74d28c9b164b210a20e749199ca00000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000030d6f89b94bf3041e37be70a58920a6fd776662b50323021c9f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000003fe784e30d12078391a01da98709ddd00d9797a00000000000000000000000000000000000000000000000000000000000000060f89b940ebe0e56b6b106763bbed1da30a4d6fc6064eadaf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000005eed85149d7c3d74d28c9b164b210a20e749199ca0000000000000000000000000000000000000000000000000000006fc23ac0000f9017c9419d376e6a10aad92e787288464d4c738de97d135f842a01e5e2baa6d11cc5bcae8c0d1187d7b9ebf13d6d9b932f7dbbf4e396438845fb8a08ea7a0f2c6330db669440c5a323715d91b904109d0935baee8f4e4864b9258f5b90120000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000007d02000000016aa52fffb7eb3b95b3df714ae12903c372ddaf1721033e90e7b5ecba0b1f97c80000000000ffffffff02802e000000000000160014a8a337fbfd692a5628e96d44684b9ee35d9e913ed9050000000000002200205920637856dee93711f762b72324791ee0322992811087e41d739c1d2095bfeb00000000000000000000000000000000000000000000000000000000000000000000000000000195835df5a6181534535040065ccff78755a022a2e62396fd04f9352b06eeb20c")
	if err != nil {
		t.Fatal(err)
	}

	proofData, err := hexutil.Decode("0x201c5d2f7f746c025582d4bf687c821d46ef2cf7d79b18a648731132aad3b1402b171c26a4b247cb749babdd443cf916774a4b74e85e3ea9ba19f4ee43638dd7032c6ea702809b843263e19d4b97cfdf2471a74a127b56ad581473c6df3d0f472d2eea103495c5e856bf5aee8b3270bd9adab84209338b6f09f51cf39a365c351ada496af014c9abf7276d854ea0d6ea6a36e090d0a45b9069f81fcb6f9fbd73032bb31aa39995a864d98c440a77b8950847066150f0e94f066054bae18704811680a1a766672149d412d5b60c57b31433f897942bf7216aa3aaf1642e4992e60c007447583c5ce87e207476241fcca408417aeff488f7165f60bce73ce7e12a171f8927ca72e68714e0a80c89f833fdbdf895cbe94e6e6892cd474d1964970d2313ad60cffff9450d1f9724fc0bb68d81f031a09209406232d5f4d7dfb4c15e262822a536f433d56b461c812916ecf692a979a0246fc8de7de0d3092c7e7a8e283342712db0f2db4ad60551e8e110799ea7bafd37990658473c9e447f93cd8809bb45473b7d249831878bd88381c76e3695ab957ff876f5fb75c3091ae7a2c82877b98e4aaca1ae32064360f9ad05d0f1595d5613a416ec544192309b8ed61b21ef0de29b4706bb0f0e91a82945168ebbe619b6987e92790a9920444de540e0264525ca3ac9f4de4a8409226e52bb18ce38d837c700f7aee5a907b45a0b5fcb06c9f5d06cb0a8558e239b09f28c90de463dc2c9d12cb985d938cca3e4cd459825bbe0d37f3de8e6a212a181cb3f5b25320afbe17a1aab305bd55e0fdaaf4a851d0cc3ae31c567fb9b466e9049b9db84936191b9cfa7f709e269c40982cfb5ca001915a0707f2a0484a92cc9befdf16e5213972d39e1cb7b2cf421159f2836c21941febd827e29c1b669181c00a9cee546cb1ee5eb391d6841f4dff4d5acc455058d495e2a39d5fc9a1a1902c7b539c791f7c72301391bac7a127a5dadbb289c16851ed31eb91037cb6f61b8d9628af08983cf94273b7425a0a96995103c95ee267b2a4d36a83faafde99eaa295de72cf58defd0e9482d4979dec70aa10e4fe506a0ab76dbb2ae094f758e74aa34d7c433fcc70bc88c3f12a878881ff6c0fee81f759700345b16aea15f43ee6ab7b3803c4d149b667ae8570d21783e1cc294dc06b40f01e8d5a42ecd7f6d50bf0b3209054a2acf7d27791754445a87a1baace024f3b5db24c273a368285f93531bba3693df99680cb56079117d301988dc2731087738b148b8626517c5768a6ad37eeb6a29c3f83145b14572cf46e29aae0660")
	if err != nil {
		t.Fatal(err)
	}

	sigs, err := client.SignBtcTx(txRaw, receiptRaw, proofData)
	if err != nil {
		t.Fatal(err)
	}

	t.Logf("%x\n", sigs)
}
