package circuits

import (
	"encoding/hex"
	"github.com/consensys/gnark-crypto/ecc"
	native_plonk "github.com/consensys/gnark/backend/plonk"
	"github.com/consensys/gnark/std/algebra/emulated/sw_bn254"
	"github.com/consensys/gnark/std/recursion/plonk"
	"github.com/consensys/gnark/test"
	ethcommon "github.com/ethereum/go-ethereum/common"
	"github.com/lightec-xyz/btc_provers/circuits/blockchain"
	"github.com/lightec-xyz/btc_provers/circuits/blockdepth"
	depthCommon "github.com/lightec-xyz/btc_provers/circuits/blockdepth/common"
	"github.com/lightec-xyz/btc_provers/circuits/blockdepth/recursivebulks"
	"github.com/lightec-xyz/btc_provers/circuits/blockdepth/timestamp"
	btcproverCommon "github.com/lightec-xyz/btc_provers/circuits/common"
	"github.com/lightec-xyz/btc_provers/circuits/txinchain"
	blockdepthUtil "github.com/lightec-xyz/btc_provers/utils/blockdepth"
	"github.com/lightec-xyz/btc_provers/utils/client"
	txinchainUtil "github.com/lightec-xyz/btc_provers/utils/txinchain"
	"github.com/lightec-xyz/common/operations"
	"github.com/lightec-xyz/daemon/common"
	"github.com/lightec-xyz/daemon/rpc"
	proversComm "github.com/lightec-xyz/provers/common"
	"github.com/rs/zerolog/log"
	"github.com/ybbus/jsonrpc/v3"
	"net/http"
	"path/filepath"
	"testing"
	"time"
)

var SetupDir = common.SetUpDir()
var url = common.GetBtcUrl()
var User = common.GetBtcUser()
var Pass = common.GetBtcPwd()
var icpPublicKey = ethcommon.FromHex("02971351ad0a4e80b4d61003a152c746bde6d7ac5cba52466727c611fdc8c20f5b")
var testaddr = ethcommon.FromHex("0x79e0F79F395CEcF90812ee7beFB883D7210e20E8")
var testsig = ethcommon.FromHex("3f8e02c743e76a4bd655873a428db4fa2c46ac658854ba38f8be0fbbf9af9b2b6b377aaaaf231b6b890a5ee3c15a558f1ccc18dae0c844b6f06343b88a8d12e3")

func TestCircuit_BtcDepositProve(t *testing.T) {
	assert := test.NewAssert(t)
	genesisBlockHeight := uint32(80640)
	latestBlockHeight := uint32(88618)
	cpBlockHeight := uint32(87112)

	txid := "d5d462bbad6fccb799b900c4e1f711867dd422bffb3067ef426c3cab3fb54ef9"
	txBlkHash := "00000000000000009c593262d36d5f37c015310e31bb592e68169e72486607f3"
	blockChainProofFile, err := HexToProof(rpc.Proof{
		"cdfc519a8117a724e4bd006101d33d2b6b949f3cfea00ab872c85a5eaf70ca7696886e50e2abfec8f0ddaf6287772d2d26ab509e310d3cb2e018814848be54d2ad9242b04f8c95bc3dfa141e0549f28efd44080358f64551b29538144c1048f1926beaa3c55b3034546c8f4eac0aec48490a498bf8d790ad0bc938551879766887dcb2057f65cbe563978d60ddaff414a4d5a28d10bd4ca56f5a4c19a74a68c1cb419acddb0781518c6539032caf1492cc9006f95a9af173a91fe64beac8fa9de98433b72a28fcf2eb27c0e79ef1c650de53de7353ee910daa248e95d6a25bdbdd109e5197393ba93f18fc7b81e39357094a92b27657e15f33e6e92543399827000000070190d8b85468fa5dbb9069fc1b5754a263ac9dc7aaa6d8faccd7795bbdf38c090a45df5271f5c565f4965a386cb664fdb49be7b6eb6bf3dea4ea9cd4a96293a413a426f016b1a6c662c2d47644f9b181629c52042f32fbef8bef85bc61d845990342c18f9e15a1d594b170bbd95e7a90be9e5397bb084a73bb61426a5e7d307d08413775c0b0442eca3bd1d755efaf3c20b541b2e6e6c3df44ac860f0f14995b196207d09f4a31b46055c966578a6cb8dc0774b27776c658c8a1fe8a13322df827ece620a9d8cb3e787f34c9c5302e29c50f30e4cc8b75444f3029be69226a8fca2fe2425763d0fe98da9d86104929893b1a55d42b4bc58479e8f29176d361eb1b369e02bdb085054b7a6a5afe8d39067762c787a59088e8d91c4c5c2a32e0b900000001e7a20ca0be747719275376881e9d2dc835491cf31cc389c7207feaf89d77e35d",
		"0000001f000000000000001f00000000000000000000000000000000899f5ecb3f265b3a137443c45252215a00000000000000000000000000000000e938f6b579ddb5c04262596f0000000000000000000000000000000000000000eed87c549b7ae4ae1321aac09d41e1e8000000000000000000000000000000006fdcfd38df168d24dd1861000000000001b92c8a49ea5831fc1393afa650c9caa9020e0b8a8afedc842dfa258e7c01a02fe0e9d7bd4ed3c1228ccebd882de76c65d5cb43fd60b8789263e411991a156b2e2adc0fb648a66a932011b9801bea213c1c3e88ec9b741d7692da5f71cdddae132fdf03b20d92069ed446a0ca750bf8c94cbd6c337decbca28e25393eb0c9cf0a6b8dd8c32eb15b4becdaa44198bd871c503d84c16cf9a7c57e199e4bb92baa2cfaba7ea4772f98bcaf9d8d24e007cf552303f27c5c39ec34f0b732b23627b012acb4058260d92611730562ec2d8a6516a005ae90e6449405f3ec593b6d4bd8136abdcf0520f2ce0db0ad39fdc6db3f4cf3e89bc797c460ac6b9cdfe765bcd528fdc1e4f7d30a7dfdac79c5231c66e1b55aa14c6db55b75a408f91e3d3a985804fa182712571c15e5739df208420643492a356643c1bde2204deff918205c5a29094286532bdbac041ba6f05c8212ff98997fb8e33d4f42748383466246c2dc2d864f33221d46ab4bb5019de7afb06e72bf88a70036b1bc885ebdb6d48d03311819221c36576aefb088ef6d25536bc038947626656a8d381c096e67a2c8233c1383cbc38d74ff29678853f0e765b8eaa8617aee21731c1dc55310975182a250253ca15f604a70e5011fe87e5e280aa470942fe92e4f1f088e2d99473d5881a9273fb769d3ad71f495a098d4356118fafc4093ff206486a918b3e683149acaa62aff51394c628f4002505b55fd4dcfe8a6791c6623d72153b0f31f08370e41e610544b0d364ed203be3c14d93e0a7dd4332de0851a6401265da2e067b0676ab200000000000000000000000000000000000000000000000000000000000000ff00000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d00000000000000000000000000000000000000000000000000000000685110c700000000000000000000000000000000000000000000000000000000686106a7000000000000000000000000000000007f8e14cd783f36405ac45b5ac82e1a310000000000000000000000000000000010ed2fba800700cb01000000000000000000000000000000000000000000000000000000000000000000000000001f2b",
	})
	assert.NoError(err)
	blockChainVkey := blockchain.GetHybridVKey(SetupDir, 10)

	txProof, err := HexToProof(rpc.Proof{
		Proof:   "ea83733f17694b3f91e70e9cd335f035e7ff22dee83c359f52701e9a8900cfa2e2998ea356cad4c543f47fad6be3b84e3fa0e11e2c4c42c2ec7dc8667e5d9741c48db09b2774534c1390a749143ee4f6c41f2605736678956ad18f9a0b99aff0a5d157e7e8d3729b099c3d983aeb436ddf79de4e45aa3d26acca7f1497ed23898cf949fff9d5c379d8ca5ddabf01ce2b5bac2190c80490d32bf07c3e492787dcadcc3b6750dda9b1799bf02833c9fcdc14979656afdd5014bafb435d6eaf7e0af052958034e9bab6fd85c368b3ed3fe5e13985c3151506f84436a44db462d68fa32c004eb628d35d4fcbefa2c0272feb54fca1704dad79c2021d0226c1b772bb0000000720a41233364b929c6454cdb847a7b434ec937ba53377f688488f452b0b01e7a5224b45d9676f4db53cf02f77ff69eeebb513ee6d83660ad30f67ec77e7fe9a5329d2ff0c1e415dde419f5533642d1e20d16f34636791df65a0f9bac3bf4e90f220004d76abc7f9e7d684a7b7192ac64b830dc7a9913e80e8c669cc70b8e385c12900b42745a6ce1fe434038b56075ac831b69c715de296a60afafba1598541410e42d317398dba173735652672d9d592cbe0b5bacda344fa9c56406eeab8dc222dc3bf5f0f933494f42725b59a41c8bf305065106371c2bf3979b00a7023d633af1b3479118c3ccfdff9e9b3c166d03804363355cae78543c6b26cf6808596692c28204fb83cba212e9859c359e55b4c5859d507f80417a90e89ee58a4c82c5700000001986ec201f524107e5b4402ddd661259b16f55079c1933dd0ade7a5188741ed58",
		Witness: "00000011000000000000001100000000000000000000000000000000f3076648729e16682e59bb310e3115c000000000000000000000000000000000375f6dd36232599c000000000000000000000000000000000000000000000000eed87c549b7ae4ae1321aac09d41e1e8000000000000000000000000000000006fdcfd38df168d24dd186100000000001bdfca792dfb8555597ee314ab754fb6e762cbaa7b8b042821fb5f8fb69d3e0229ae1143a5f570681aeddc7294f8f99232e58cfc3d20219531a3097181fad05e2ae89c742705b0e4028319e81da84b23fd408ff0df57adf810c511eb68b22dc2033e7952456b7d4141bc1757d923fd9d61d42459f57cdf6262afad7a3e3d15581464d7d24e15c3b0d4602e6b87e6f4e5c49eec26556a422d907d8bea2d5ac3e21c3b1092b7861bea381e289e215f3b8a9f887a39590c6d3d146036f899b5d06a2762d92719d61db46a7b4f853e14c6e37c1de0dacb477ef96741f9478fb1b4141d051995a3aa01238e3eb7d7dca3cd2becc17765c6d75740b3ef3561f5e2997c06b862e4adcf1417aa3b5df0cd02aa91519c73cea042a08a818702425ee232a42fd2239171f2f166cad0a0b39468d8b8b272dec65759b254e582641498335f93053146e546fe5e0becc78d10e592c32e12b99ca8ecd0ba0f598e3692f40df4eb305d0c686af9712ef133bd9747af2584c760b048228d33727530b0a6aee0c0480000000000000000000000000000000000000000000000000000000000000049",
	})
	assert.NoError(err)
	txDepthProof := depthCommon.DepthProof{
		Proof:             txProof,
		IsRecursive:       true,
		LastAbsorbedDepth: 4,
	}

	cpProof, err := HexToProof(rpc.Proof{
		Proof:   "c8656af3109e8e4bc23666a4afdb90cec464f81363be4c4c49c7419eb8d523ec94e684a0df28f0564a0da0f0ec93ff954f89e8948a77510b533c847e52146852a850a4ea7aa72b0f41668098b78a3e7500ab8bd03da09ecc729e10fb1e02ded6cbc27d8306a5c1b4c171731ab7808db41148b1c974c57fe0a9d6e5ef1345fef3960c71e46da3829be3a8525005ff219a8fcf77b4f3cfadbaa824852d224012aad52fccc00ba20baa58fc09ff68f5ba7b054c44e786ff98396b85d6a1f4388fd69b2f8dfd3b87938d20dcf703f4b0072303ae1d9018cbf011e38c2db30bb3c6e1cb35becf65be85b8c3e173f9f7f832d0de6e97435d6508e4a886915181ffbca5000000072c195dbd032750fe1d2b9e5cc2fcfdd5a3315ba26cafe9c1e861f88c68e8d7700eed4896abf17e27f407d8324e894e1021d46fd4014921220b98c8f55ba27f7a1805b3dfae1230aaafbf8e17388cfbc3b553c8df28824c87f45cb451e4dabf1730034b0802cf08813c16a31467ae4113d2ad2df82052c0f6adcf1d6d2a3cba291773d5f9b03c4c634fb0ea99fbe899f0c1161510fd3a1e119c9290b28501e1a213ddc9b753ee4a5412ecaa63ead81d0cc4de0c40d3bda6aea30051b986799845078461d0cef118c19977f4653d5381cbc3945d809a5dde969c581cfd67cf708ed447d574dde9ebdceed68828228201d9333c93995f8ba3b1786c9afeafdf8b34295959f27c04bed759c2d5915910b6682341fd967424e40fa092889055e93c3d00000001cd2d6022d1c7c42cc5da406e701240d42eaae51c31ea2ae879324ab1a4d67ba5",
		Witness: "00000011000000000000001100000000000000000000000000000000518313a76cb91f3317901aecbb99cb5600000000000000000000000000000000cba6fe606531969f040000000000000000000000000000000000000000000000eed87c549b7ae4ae1321aac09d41e1e8000000000000000000000000000000006fdcfd38df168d24dd186100000000001bdfca792dfb8555597ee314ab754fb6e762cbaa7b8b042821fb5f8fb69d3e0229ae1143a5f570681aeddc7294f8f99232e58cfc3d20219531a3097181fad05e2ae89c742705b0e4028319e81da84b23fd408ff0df57adf810c511eb68b22dc2033e7952456b7d4141bc1757d923fd9d61d42459f57cdf6262afad7a3e3d15581464d7d24e15c3b0d4602e6b87e6f4e5c49eec26556a422d907d8bea2d5ac3e21c3b1092b7861bea381e289e215f3b8a9f887a39590c6d3d146036f899b5d06a2762d92719d61db46a7b4f853e14c6e37c1de0dacb477ef96741f9478fb1b4141d051995a3aa01238e3eb7d7dca3cd2becc17765c6d75740b3ef3561f5e2997c06b862e4adcf1417aa3b5df0cd02aa91519c73cea042a08a818702425ee232a42fd2239171f2f166cad0a0b39468d8b8b272dec65759b254e582641498335f93053146e546fe5e0becc78d10e592c32e12b99ca8ecd0ba0f598e3692f40df4eb305d0c686af9712ef133bd9747af2584c760b048228d33727530b0a6aee0c04800000000000000000000000000000000000000000000000000000000000005e2",
	})
	assert.NoError(err)
	cpDepthProof := depthCommon.DepthProof{
		Proof:             cpProof,
		IsRecursive:       true,
		LastAbsorbedDepth: 10,
	}

	timestampProof, err := HexToProof(rpc.Proof{
		Proof:   "85079f3c4ffe780598114752c56c3184b8a68081ef92793b0659384ee50078bcd9f3db6680e923298d22c4c9672e1c25113ddd11da09a1af44668ead2f44eb2ecf6192598f84650c50b8414d8d26238158a22a7ae2f900b6fb8adc332bc089f09e57a76ab2ab6bac4f51f6f2b85ee83f3198be5499c9457bc312add7e4f6ed6ae4c654a202a484640098b4faad3bc7d11dbc605bca83711b496dd3f0973ff67be0e8bba3d0552ec9b005b3a92132cf5bdb59952d5d4726727dddc97e46fdc7b49bc9c93eb99a499ffd5c8b1b5f8952aaf6c0fd72bad49bf6b85275fa945e13828dd31ffa79a02b970e7b95ab560f86e6d5157c3238911156605909aef6d4584400000007255bda5bef8c6cc49db5d2ed1175bd254370318ec9378ee52012d93e7eb183d8100824cb0da2d57498287adc1a40c6d29c4eff7a41a3e87763e74b6ebd4e110f1d900a7b7eb3a36f3e8b2540ae686c861761dde70c966ebda6a1af6181e23807117f1ea0b36e22834cd4d56947830d06eeb6d547ae63c1b21741dd28f0ac9e420679d232eb0caf092b7ac8999fe028b8df1db9202faf36d7e35bb50eaa454a4522cb80bc282b35dce7a5713505f401fdc308a5614e4f7e6c1ec7c293c1dc40da0d2e54a212cfb6f446eba8f6919c39f5a5f8eb79ec8c747e5bfc06fa50debd58de8fe062405f996129cfa7b019eb6dc75e4199cee2b5d804ce5a8204c2a16ed514ef6fa0bc8ee975b56773d4ab56ae57c506d8a3b0d16c81667844c9ff4ce901000000018706249b477a87fd6cee56172f6cff7d40d4fc485afbd104e4efe6a36581aeea",
		Witness: "000000070000000000000007000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000f3076648729e16682e59bb310e3115c000000000000000000000000000000000375f6dd36232599c000000000000000000000000000000000000000000000000000000000000000000000000686079db0000000000000000000000000000000051821737b443a12b30389dba503b606a00000000000000000000000000000000ac2f0480999cfd3c06913b0000000000000000000000000000000000000000000000000000000000000000006860ce58",
	})
	assert.NoError(err)

	blockDepthsCircuitFile, err := blockdepth.GetCircuitFiles(SetupDir)
	assert.NoError(err)
	timestampCircuitFile, err := timestamp.GetCircuitFile(SetupDir)
	assert.NoError(err)
	circuit, err := txinchain.NewDepositTxCircuit[sw_bn254.ScalarField, sw_bn254.G1Affine, sw_bn254.G2Affine, sw_bn254.GTEl](
		SetupDir, blockDepthsCircuitFile, timestampCircuitFile, [33]byte(icpPublicKey))
	assert.NoError(err)
	httpClient := &http.Client{Timeout: 3 * time.Minute}
	cl := client.NewJsonRpcClient(url, User, Pass, &jsonrpc.RPCClientOpts{HTTPClient: httpClient})
	txBlk, err := cl.GetBlock(txBlkHash)
	assert.NoError(err)
	txBlockHeight := uint32(txBlk.Height)
	cptimeProofData, err := blockdepthUtil.GetCpTimestampProofData(cl, txBlockHeight)
	assert.NoError(err)

	smooth, err := blockdepthUtil.GetSmoothedTimestampProofData(cl, latestBlockHeight)
	assert.NoError(err)
	smoothedTimestamp := smooth.Timestamp

	proofData, err := txinchainUtil.GetTxInChainProofData(cl, txid, txBlkHash, latestBlockHeight, cpBlockHeight, genesisBlockHeight)
	assert.NoError(err)

	txDepthVkey, err := recursivebulks.GetDepthVey(SetupDir, txDepthProof.IsRecursive, txDepthProof.LastAbsorbedDepth)
	assert.NoError(err)
	cpDepthVkey, err := recursivebulks.GetDepthVey(SetupDir, cpDepthProof.IsRecursive, cpDepthProof.LastAbsorbedDepth)
	assert.NoError(err)
	latestBlkHash, err := cl.GetBlockHash(int64(latestBlockHeight))
	assert.NoError(err)
	sigverifProofData, err := blockdepthUtil.GetSigVerifProofData(latestBlkHash[:], testsig, icpPublicKey)
	assert.NoError(err)
	timestampVkey, err := timestamp.GetVKey(SetupDir)
	assert.NoError(err)

	assignment, err := txinchain.NewDepositTxAssignment[sw_bn254.ScalarField, sw_bn254.G1Affine, sw_bn254.G2Affine, sw_bn254.GTEl](
		blockChainVkey, txDepthVkey, cpDepthVkey, timestampVkey,
		blockChainProofFile, txDepthProof.Proof, cpDepthProof.Proof, timestampProof,
		*sigverifProofData,
		proofData,
		testaddr,
		smoothedTimestamp,
		cptimeProofData.Flag,
	)
	assert.NoError(err)
	err = test.IsSolved(circuit, assignment, ecc.BN254.ScalarField())
	assert.NoError(err)
}

func TestCircuit_BtcRedeemProve(t *testing.T) {
	assert := test.NewAssert(t)
	genesisBlockHeight := uint32(0)
	latestBlockHeight := uint32(0)
	cpBlockHeight := uint32(0)
	txid := "4433ee2d2192877cf2e1a1a277e65c6515f3ee40b6b3e0a47dcfc62fbed58a9e"
	txBlkHash := "0000000000000005230355bc3a4fd83c94bf1d2201c153d7950bfbf913820261"
	minerReward, err := hex.DecodeString("0000000000000000000000000000000000000000000000000002d79883d20000")
	assert.NoError(err)
	blockChainProofFile, err := HexToProof(rpc.Proof{
		Proof:   "e2c0aecd74160e482f4fedc576184c2116556c9d939e558e62e8ca27b6c668bc9540141af5464db5959fa6de00015edb75f71ceb1a6efc779a7031b779749fd0e2530643e114566ea4cf2081cd516dd16b9b168de6739b9a991b353ccd6bfa48d294dd24f03fa8044dc55abec1db09f4bbb1d1a06603f9e894c4aa5bc165486a8e9199302e75cb77ba4011a47fd2c2b05f1df5f038be631768a6a4da613fc0edc43fff2de86fe7d31c207b519c45cc89279c328a582d81ee2e10c8a707aa75aa98b36824ef79795f03d3d0c6e10265f3331910ac0f9cb557376dd4dab20788f7933c2d773d2487386223a28d2dc6613f54eac912dc82d6aabb73b7b3cda7960c000000070c6426885094b4ce505f4ce6865c80c4fc11de360f5cc46e01be1b7d7ca52d982db4c7781fd3805e78d9f608c5fe6e2537f55090894b3639dd49934b0a4a3f55225b907776e1af9572ac838465b7f885d3ad7a3bfad129146b0c30379fe2b8b92109fd6a87ed25dd683d6f4397af10e2c79943c6e0586561c7728131684e3a3d1210b82ad2b5347411bef67eb3187057fdf952217208882e09b6c27fc524d32b021da9634b0a8ec36875bb48b9d8d8b504d69550d4b77e18fedc07111bf8a5a423272358d78add5e15658941e81619d2c775300438bda111ef27df3b5c4478bb85c6234089f7f253265969ee94ff372e05f26873e2d2c5aefc5a3919ad4374cf10a64449002c0bb8ef2f29851e8d2fa42d84edc99b79f1c7e04952140299df3500000001845c487ec8ae86db803760891b7dce5bb8d2423e8d3b97aa2c4afa22be0ccb6c",
		Witness: "0000001f000000000000001f00000000000000000000000000000000899f5ecb3f265b3a137443c45252215a00000000000000000000000000000000e938f6b579ddb5c04262596f0000000000000000000000000000000000000000cc01fa87749ac6b0957a0f1f12ce9fef000000000000000000000000000000009e3fbbfa5a408bd73dc906000000000001b92c8a49ea5831fc1393afa650c9caa9020e0b8a8afedc842dfa258e7c01a02fe0e9d7bd4ed3c1228ccebd882de76c65d5cb43fd60b8789263e411991a156b2e2adc0fb648a66a932011b9801bea213c1c3e88ec9b741d7692da5f71cdddae132fdf03b20d92069ed446a0ca750bf8c94cbd6c337decbca28e25393eb0c9cf0a6b8dd8c32eb15b4becdaa44198bd871c503d84c16cf9a7c57e199e4bb92baa2cfaba7ea4772f98bcaf9d8d24e007cf552303f27c5c39ec34f0b732b23627b012acb4058260d92611730562ec2d8a6516a005ae90e6449405f3ec593b6d4bd8136abdcf0520f2ce0db0ad39fdc6db3f4cf3e89bc797c460ac6b9cdfe765bcd528fdc1e4f7d30a7dfdac79c5231c66e1b55aa14c6db55b75a408f91e3d3a985804fa182712571c15e5739df208420643492a356643c1bde2204deff918205c5a29094286532bdbac041ba6f05c8212ff98997fb8e33d4f42748383466246c2dc2d864f33221d46ab4bb5019de7afb06e72bf88a70036b1bc885ebdb6d48d03311819221c36576aefb088ef6d25536bc038947626656a8d381c096e67a2c8233c1383cbc38d74ff29678853f0e765b8eaa8617aee21731c1dc55310975182a250253ca15f604a70e5011fe87e5e280aa470942fe92e4f1f088e2d99473d5881a9273fb769d3ad71f495a098d4356118fafc4093ff206486a918b3e683149acaa62aff51394c628f4002505b55fd4dcfe8a6791c6623d72153b0f31f08370e41e610544b0d364ed203be3c14d93e0a7dd4332de0851a6401265da2e067b0676ab200000000000000000000000000000000000000000000000000000000000000ff00000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d00000000000000000000000000000000000000000000000000000000685110c7000000000000000000000000000000000000000000000000000000006859802a000000000000000000000000000000007f8e14cd783f36405ac45b5ac82e1a310000000000000000000000000000000010ed2fba800700cb01000000000000000000000000000000000000000000000000000000000000000000000000001bbd",
	})
	assert.NoError(err)
	blockChainVkey := blockchain.GetHybridVKey(SetupDir, 4)

	txProof, err := HexToProof(rpc.Proof{
		Proof:   "9f41da2882fa4cb303dbb6851c0901631ace9290a112f34afbf84f6e27392e07e4a5d240e09ba64de11f345cfc14e60bb2b5df394de26b10a26f0ce9ade616e2dbe15527a7f890166a957729dd7a6be985f5ddcb7569d8ffa5e3fcb265b016df87c659e20d1c1c60d3fd9b404ed51404e33a068129989941b93df5890297e914af55b84118d26e44d01671780c4cfbd42763a108016a91d35cc4f23237d03cf19804abafbc3636aa547a21730026d5c0dd8f9d1c4a2b20482125aeb167b331119b2f3f57a848594ff9451e7764744a3e84fd517af7872403b292d2165ca91808d2ba80f5c71b22451705cccc75a888512397f39bd2cd5e3122029fab0b4fd2a3000000071d62ce2cf06d3918f833c9187d84d0d630589fa4dd8995d8cbf40c52e9ed5d071cfd915152fc9abf4a866737b4f3b3819018f07e7fbcb03f3cbf561ece67c3fb229b093261a5fc3a927b9c222fd1b2db2c98b9c8468b97f25416989d7cb3da33276bcd0c637b04db10fc644bc5f3b002c5872bdbc15a450cfed1153b7cbb10d11bfc875f411adeaa2800c1be0a813cdbd2d87766a945829d8e091124e04bf8b30411501e502cbcb386d059294ff2dae8517b6f0a3a700f94e8c657377be9452f297e9768d562db09d0ed1b53d0f6d98722079005585ad1b8bcc2f350af19c62cd5ff7c51e6769d3520bc2f916df7f9455d0dec8fbc9294a073acaad36bd1cb4609478047757601d314c2705611c9f21fa43102ff615481c8116c29790fb544c1000000018d7b9c360dc9594b9b3c57240484b2be80a96c02ee9e0c29b939b19609036209",
		Witness: "00000011000000000000001100000000000000000000000000000000a6e9eb68ae11b49e4464f9418d7af2be000000000000000000000000000000007717e5c9ea54aa76000000000000000000000000000000000000000000000000cc01fa87749ac6b0957a0f1f12ce9fef000000000000000000000000000000009e3fbbfa5a408bd73dc90600000000001bdfca792dfb8555597ee314ab754fb6e762cbaa7b8b042821fb5f8fb69d3e0229ae1143a5f570681aeddc7294f8f99232e58cfc3d20219531a3097181fad05e2ae89c742705b0e4028319e81da84b23fd408ff0df57adf810c511eb68b22dc2033e7952456b7d4141bc1757d923fd9d61d42459f57cdf6262afad7a3e3d15581464d7d24e15c3b0d4602e6b87e6f4e5c49eec26556a422d907d8bea2d5ac3e21c3b1092b7861bea381e289e215f3b8a9f887a39590c6d3d146036f899b5d06a2762d92719d61db46a7b4f853e14c6e37c1de0dacb477ef96741f9478fb1b4141d051995a3aa01238e3eb7d7dca3cd2becc17765c6d75740b3ef3561f5e2997c06b862e4adcf1417aa3b5df0cd02aa91519c73cea042a08a818702425ee232a42fd2239171f2f166cad0a0b39468d8b8b272dec65759b254e582641498335f93053146e546fe5e0becc78d10e592c32e12b99ca8ecd0ba0f598e3692f40df4eb305d0c686af9712ef133bd9747af2584c760b048228d33727530b0a6aee0c048000000000000000000000000000000000000000000000000000000000000025a",
	})
	assert.NoError(err)
	txDepthProof := depthCommon.DepthProof{
		Proof:             txProof,
		IsRecursive:       true,
		LastAbsorbedDepth: 9,
	}

	cpProof, err := HexToProof(rpc.Proof{
		Proof:   "87ac8257b328d73d19ea477671c37af50154ce088897e47cd79ac5d9b9872d9ed00cfacb3eb20f92f3d3323894d59561ae42ae57819ed9e07224732eebff0cdedebd7a4c54a0814dfdcfc49f72afa61dcc78cabb58c73bd0d4e6302065e3faccd08ce2ae5a71a9376e14c012b3a05b6bccc88940b1427907952f6259335407aea2e7ac14d3c0194070d36fdc5c323b7e4adbcd201377bee7be45165315185bf2e24985c77c0172a0bcc2028c639b0b18a271dae42a1337ad6257435f2e9f492ed9dd3e83cea659d507ec6b9ecd29b1249fda991c088b1512e3291960d7044d8f916cbbb7a9c0df16d3c0441968ff382411409018cec233b7d6bb1a6576abe867000000072ad87d911efcb57734eb6628ad29b5ade6025f9f2e674d580bc7c20fec360e081bcbaaa68c7d5a10de252b255df9b7d61156c0cbbc30df01d81d3e5cc21aa65401ede860a8509aef5c45f583fc220e41a33c15a971ddcfc6992c401f32af720a2cd5896bdcb2473275b880b7c6b91fc918c0cff415a182a63a7087843ac8b46c232ae5400e989f516ffffb50e6a5aee5a621bbd02e9e4d8c1e8e9ca96435fc61048f7ec2fd1150aa6c9b4175473855144f9f2467093238ce607c4d679a16e668042535ae62818ae3646a1e3a480285ffabcc69bd59eea44a5052aa1f7e2cfc2099fa92cd2f9793fc35354d9fba27b27ba4ea6172a8bf59894c1b1019b12cc2c62f7a28c16a5d823d47d469d701b069baa92ee5bc909e7395cf60a5a4f0692f1e00000001a173301e0112e0383ef47a10082c7ea1d2a7eba259d8f82b05e6d7ba3706e6ba",
		Witness: "0000001100000000000000110000000000000000000000000000000089cc4d1064ddd2f4a4f140172498377700000000000000000000000000000000ee744c35a07b9b6af72e8f980000000000000000000000000000000000000000cc01fa87749ac6b0957a0f1f12ce9fef000000000000000000000000000000009e3fbbfa5a408bd73dc90600000000001bdfca792dfb8555597ee314ab754fb6e762cbaa7b8b042821fb5f8fb69d3e0229ae1143a5f570681aeddc7294f8f99232e58cfc3d20219531a3097181fad05e2ae89c742705b0e4028319e81da84b23fd408ff0df57adf810c511eb68b22dc2033e7952456b7d4141bc1757d923fd9d61d42459f57cdf6262afad7a3e3d15581464d7d24e15c3b0d4602e6b87e6f4e5c49eec26556a422d907d8bea2d5ac3e21c3b1092b7861bea381e289e215f3b8a9f887a39590c6d3d146036f899b5d06a2762d92719d61db46a7b4f853e14c6e37c1de0dacb477ef96741f9478fb1b4141d051995a3aa01238e3eb7d7dca3cd2becc17765c6d75740b3ef3561f5e2997c06b862e4adcf1417aa3b5df0cd02aa91519c73cea042a08a818702425ee232a42fd2239171f2f166cad0a0b39468d8b8b272dec65759b254e582641498335f93053146e546fe5e0becc78d10e592c32e12b99ca8ecd0ba0f598e3692f40df4eb305d0c686af9712ef133bd9747af2584c760b048228d33727530b0a6aee0c0480000000000000000000000000000000000000000000000000000000000000850",
	})
	assert.NoError(err)
	cpDepthProof := depthCommon.DepthProof{
		Proof:             cpProof,
		IsRecursive:       true,
		LastAbsorbedDepth: 5,
	}

	timestampProof, _ := HexToProof(rpc.Proof{
		Proof:   "dc7816d60c293a946d25cbe188556ae56ba359a31a498f74de7fcc61d773ae3ae0ff037d4844fe76cf8c20e34ea2823c5609afe6aa6141d5f1f74c7ad9545cd2c3b38a266f4749542b820e8ced57d2e7b035c86ea53b324353b04805a798e7f8b02fc5fdd2fe45efba14c0597a31945c2cf8d0b4c10d1358d8aa687dd99a89c1af907bf824f45c9180fcca0d6810418825f056d66b0b0a8c6374d159c349316893f5ec88a155aa6ac74c1499699ae464a7671ce1f69ecf85152ebaad43310431c3e9fa7149100489c1a53c85060dfd595455b183f9ca4c2b04673483a60d2968ec04fbf2bf6fc0d2e3a679a86b6c0cc0b7f377847d7dbb110be3caa6df229f75000000070855d5fce44a6cec649c5b28a2c257d9c0fd8c03009c0095cb32bfd32028de2d11083535d409ca040faa43109e1ef9b22ebc5179a5c2ad22648da8de91d906e90f2dc4aa81c907063bf7f9e1d838ead7e0b8beb46c7c15917414a94c39407213190519662c889513531e9e8ebdc14e621dd62a02e7a65e565b2ac147e3712ee62d5d29924d0a75d65bdfe8352747273995c95104c92f68c69b8e33cf3ff9c36f2cc45234df24a0d6582ea3732d22c785fd28b0713c9ba05dafd66f61e484cd090801cc2b020eaa490107258b1e4ee9da6fc3396fba189857a7689ee6ac7ee62ae432180f8fecf17c3acd7b5b1ae9f7ddc962eb23db37ef6058011daefb599d3c2b47251202764cfcb6865085e5f48bfe93c680ddeed44d74b273a34a254dd56b000000018feaadf70e3027175c27e4712deafe3a27d929bacea64cc6287d7d85a386488b",
		Witness: "000000070000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a6e9eb68ae11b49e4464f9418d7af2be000000000000000000000000000000007717e5c9ea54aa760000000000000000000000000000000000000000000000000000000000000000000000006854aae600000000000000000000000000000000cc01fa87749ac6b0957a0f1f12ce9fef000000000000000000000000000000009e3fbbfa5a408bd73dc906000000000000000000000000000000000000000000000000000000000000000000685947dc",
	})
	redeemProof, err := HexToProof(rpc.Proof{
		Proof:   "",
		Witness: "",
	})
	assert.NoError(err)
	blockDepthsCircuitFile, err := blockdepth.GetCircuitFiles(SetupDir)
	assert.NoError(err)

	timestampCircuitFile, err := timestamp.GetCircuitFile(SetupDir)
	assert.NoError(err)

	redeemInEthCircuitFile, err := getEthRedeemCircuitFile(SetupDir)
	assert.NoError(err)

	circuit, err := txinchain.NewRedeemTxCircuit[sw_bn254.ScalarField, sw_bn254.G1Affine, sw_bn254.G2Affine, sw_bn254.GTEl](
		SetupDir, blockDepthsCircuitFile, timestampCircuitFile, redeemInEthCircuitFile, [33]byte(icpPublicKey))
	assert.NoError(err)

	cl := client.NewJsonRpcClient(url, User, Pass)

	proofData, err := txinchainUtil.GetTxInChainProofData(cl, txid, txBlkHash, latestBlockHeight, cpBlockHeight, genesisBlockHeight)
	assert.NoError(err)

	txDepthVkey, err := recursivebulks.GetDepthVey(SetupDir, txDepthProof.IsRecursive, txDepthProof.LastAbsorbedDepth)
	assert.NoError(err)
	cpDepthVkey, err := recursivebulks.GetDepthVey(SetupDir, cpDepthProof.IsRecursive, cpDepthProof.LastAbsorbedDepth)
	assert.NoError(err)
	timestampVkey, err := timestamp.GetVKey(SetupDir)
	assert.NoError(err)

	txBlk, err := cl.GetBlock(txBlkHash)
	assert.NoError(err)
	txBlockHeight := uint32(txBlk.Height)
	cptimeProofData, err := blockdepthUtil.GetCpTimestampProofData(cl, txBlockHeight)
	assert.NoError(err)
	latestBlkHash, err := cl.GetBlockHash(int64(latestBlockHeight))
	assert.NoError(err)
	sigverifProofData, err := blockdepthUtil.GetSigVerifProofData(latestBlkHash[:], testsig, icpPublicKey)
	assert.NoError(err)
	smoothedTImeProofData, err := blockdepthUtil.GetSmoothedTimestampProofData(cl, uint32(latestBlockHeight))
	assert.NoError(err)
	assignment, err := txinchain.NewRedeemTxAssignment[sw_bn254.ScalarField, sw_bn254.G1Affine, sw_bn254.G2Affine, sw_bn254.GTEl](
		blockChainVkey, txDepthVkey, cpDepthVkey, timestampVkey, redeemInEthCircuitFile.Vkeys[0],
		blockChainProofFile, txDepthProof.Proof, cpDepthProof.Proof, timestampProof, redeemProof,
		*sigverifProofData,
		proofData,
		testaddr,
		smoothedTImeProofData.Timestamp,
		cptimeProofData.Flag,
		[32]byte(minerReward),
	)
	assert.NoError(err)
	err = test.IsSolved(circuit, assignment, ecc.BN254.ScalarField())
	assert.NoError(err)
}

func TestCircuit_BtcTimestamp(t *testing.T) {
	//btctimestamp_82536_82572
	assert := test.NewAssert(t)
	circuit := timestamp.NewTimestampCircuit()
	cl := client.NewJsonRpcClient(url, User, Pass)
	cptimeProofData, err := blockdepthUtil.GetCpTimestampProofData(cl, 86985)
	assert.NoError(err)
	smoothedTimestampProofData, err := blockdepthUtil.GetSmoothedTimestampProofData(cl, 87009)
	assert.NoError(err)
	assignment, err := timestamp.NewTimestampAssignment(cptimeProofData, smoothedTimestampProofData)
	assert.NoError(err)
	err = test.IsSolved(circuit, assignment, ecc.BN254.ScalarField())
	assert.NoError(err)
}

func TestCircuit(t *testing.T) {
	witness, err := HexToWitness("0000000c000000000000000c00000000000000000000000000000000d08db4027b8f424d01cbe680e8ed3b8b0000000000000000000000000000000002063b2fed2a00c201000000000000000000000000000000000000000000000035325811e9c78be9cfb2db80e52fc0640000000000000000000000000000000015e38ed0165aa493850026b900000000000000000000000000000000000000000000000000000000000000000000010b00000000000000000000000000000000fc4e5b5c36c904c00ac73988ef7e6ead0000000000000000000000000000000034d788fac6fc29a967306d277b1526910000000000000000000000000000000047258a14bea341b27be1e305813ffade00000000000000000000000000000000fa4735eb61ea275603000000000000000000000000000000000000000000000000000000000000000000000067f4a34a000000000000000000000000000000000000000000000000000000000000001500000000000000000000000079e0f79f395cecf90812ee7befb883d7210e20e8")
	if err != nil {
		t.Fatal(err)
	}
	vector := witness.Vector()
	t.Log(vector)
	bigInts, err := HexWitnessToBigInts("0000000c000000000000000c00000000000000000000000000000000d08db4027b8f424d01cbe680e8ed3b8b0000000000000000000000000000000002063b2fed2a00c201000000000000000000000000000000000000000000000035325811e9c78be9cfb2db80e52fc0640000000000000000000000000000000015e38ed0165aa493850026b900000000000000000000000000000000000000000000000000000000000000000000010b00000000000000000000000000000000fc4e5b5c36c904c00ac73988ef7e6ead0000000000000000000000000000000034d788fac6fc29a967306d277b1526910000000000000000000000000000000047258a14bea341b27be1e305813ffade00000000000000000000000000000000fa4735eb61ea275603000000000000000000000000000000000000000000000000000000000000000000000067f4a34a000000000000000000000000000000000000000000000000000000000000001500000000000000000000000079e0f79f395cecf90812ee7befb883d7210e20e8")
	if err != nil {
		t.Fatal(err)
	}
	t.Log(bigInts)
}

func TestHexToPlonkProof(t *testing.T) {
	proof, err := HexToProof(rpc.Proof{
		Proof:   "ea7658d0475d15da6c23b65d8d2a92d439caf64a43fd2e7d0185b8e3d4128d659ae0f0a9b7b22f8f68ab12ea162e1c0bc08727019898edfaf640c4c44226fb9da1040f078179ededa821c3d5f9faa539fc7ff4b15efc3eb25ae964c4eb85731ca26c260e1dd8f14cf22c0ad7fe9bd3a5d6722f5c4d21938ffd13dc421d65e68caac182d1e91ee61f678858b91a3b8d65cbc4f28b4700577097a46dc0cb2a49c2912fedca7fb3851189cb6943ea5267ad45f35ecabf012bff8dd123fc112624e6a639a64b191e6ab11fdf962b7a7509614200bd39931183ba6a30c603efe94d2b96472b5dc89160625fa9e89ca6d5b389d912c6485f5dbe62aa7e5ad01e7e9681000000071fb37a91464a0b27520dac53e428d7c3f7808d584804050fca1888a5058e766c02ce3d67669f758f92342d5696cbb869f725014554984e2fd701eb7e848a05e12c726bfd2b68c28b3abf7015990a5af97296eb5eda1455eb0ae8f5126917d6822c15b819b74a43d476e50076e050852fa807542137883e2abaf8bbd1058124de28d77bb0541018cd1dc0595d76f9bfeebd7c672d4fae266af80975496702c5772a3d57adb22ed4cc6ade861fb3b3803d42b36e6d36e3e3fc42dd63432febf5f60d9c4cc44afc6d341acc605954da95cebb124c8a7fe6942ff90e19aea9556b56ea00e3bcfbc62a2046b498394d93c1091bba675a1028aea8006ef9c83ada934807a7b1e3f4aa9afe30c4262911890a9e6a4489dc7dcf2235bcd856d885be0af800000001818c621931b915d0e929c6f22fb9a85193f47697ef9b9384507e1b773553ef07",
		Witness: "00000007000000000000000700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000046b6b4c40486ecf56ae7298a2942fee800000000000000000000000000000000ad7269540cd8d949030000000000000000000000000000000000000000000000000000000000000000000000684117960000000000000000000000000000000008fa9e487c4e0f09c387e6f0988f3c68000000000000000000000000000000001cc46b54424ee1c1c1945da000000000000000000000000000000000000000000000000000000000000000006842b811",
	})
	if err != nil {
		t.Fatal(err)
	}
	t.Log(proof)
	wit, err := plonk.ValueOfWitness[sw_bn254.ScalarField](proof.Witness)
	if err != nil {
		t.Fatal(err)
	}
	//00000000a05d94c1c1e14e42546bc41c683c8f98f0e687c3090f4e7c489efa08
	elems := wit.Public[timestamp.OffsetOutgoingHash : timestamp.OffsetOutgoingHash+timestamp.CountOutgoingHash]
	hash := getLinkedIdHash(elems)
	t.Logf("%x\n", hash)

}

func Test_duty(t *testing.T) {
	proof, err := HexToProof(rpc.Proof{
		Proof:   "ea7658d0475d15da6c23b65d8d2a92d439caf64a43fd2e7d0185b8e3d4128d659ae0f0a9b7b22f8f68ab12ea162e1c0bc08727019898edfaf640c4c44226fb9da1040f078179ededa821c3d5f9faa539fc7ff4b15efc3eb25ae964c4eb85731ca26c260e1dd8f14cf22c0ad7fe9bd3a5d6722f5c4d21938ffd13dc421d65e68caac182d1e91ee61f678858b91a3b8d65cbc4f28b4700577097a46dc0cb2a49c2912fedca7fb3851189cb6943ea5267ad45f35ecabf012bff8dd123fc112624e6a639a64b191e6ab11fdf962b7a7509614200bd39931183ba6a30c603efe94d2b96472b5dc89160625fa9e89ca6d5b389d912c6485f5dbe62aa7e5ad01e7e9681000000071fb37a91464a0b27520dac53e428d7c3f7808d584804050fca1888a5058e766c02ce3d67669f758f92342d5696cbb869f725014554984e2fd701eb7e848a05e12c726bfd2b68c28b3abf7015990a5af97296eb5eda1455eb0ae8f5126917d6822c15b819b74a43d476e50076e050852fa807542137883e2abaf8bbd1058124de28d77bb0541018cd1dc0595d76f9bfeebd7c672d4fae266af80975496702c5772a3d57adb22ed4cc6ade861fb3b3803d42b36e6d36e3e3fc42dd63432febf5f60d9c4cc44afc6d341acc605954da95cebb124c8a7fe6942ff90e19aea9556b56ea00e3bcfbc62a2046b498394d93c1091bba675a1028aea8006ef9c83ada934807a7b1e3f4aa9afe30c4262911890a9e6a4489dc7dcf2235bcd856d885be0af800000001818c621931b915d0e929c6f22fb9a85193f47697ef9b9384507e1b773553ef07",
		Witness: "0000000500000000000000050000000000000000000000000000000052bbd8287d0e455ce6cd732fa8a5f00300000000000000000000000000000000e2ad82fd0ed3a59516f9ae1642f1b182000000000000000000000000000000006813630637d6a988524df57593226224000000000000000000000000000000002bd5a4486946ff011bdd58c4397b3d93277ec7d103b795b0312ef743d572336c1522932ac2fa6041457f69a1a9836f09",
	})
	if err != nil {
		t.Fatal(err)
	}
	t.Log(proof)
	wit, err := plonk.ValueOfWitness[sw_bn254.ScalarField](proof.Witness)
	if err != nil {
		t.Fatal(err)
	}
	//00000000a05d94c1c1e14e42546bc41c683c8f98f0e687c3090f4e7c489efa08
	elems := wit.Public[proversComm.GenesisScSSZRootOffsetInScDutyWitness : proversComm.GenesisScSSZRootOffsetInScDutyWitness+proversComm.LinkageIDElements]
	hash := getLinkedIdHash(elems)
	t.Logf("%x\n", hash)

}

func TestTxWitness(t *testing.T) {
	proof, err := HexToProof(rpc.Proof{
		Proof:   "85079f3c4ffe780598114752c56c3184b8a68081ef92793b0659384ee50078bcd9f3db6680e923298d22c4c9672e1c25113ddd11da09a1af44668ead2f44eb2ecf6192598f84650c50b8414d8d26238158a22a7ae2f900b6fb8adc332bc089f09e57a76ab2ab6bac4f51f6f2b85ee83f3198be5499c9457bc312add7e4f6ed6ae4c654a202a484640098b4faad3bc7d11dbc605bca83711b496dd3f0973ff67be0e8bba3d0552ec9b005b3a92132cf5bdb59952d5d4726727dddc97e46fdc7b49bc9c93eb99a499ffd5c8b1b5f8952aaf6c0fd72bad49bf6b85275fa945e13828dd31ffa79a02b970e7b95ab560f86e6d5157c3238911156605909aef6d4584400000007255bda5bef8c6cc49db5d2ed1175bd254370318ec9378ee52012d93e7eb183d8100824cb0da2d57498287adc1a40c6d29c4eff7a41a3e87763e74b6ebd4e110f1d900a7b7eb3a36f3e8b2540ae686c861761dde70c966ebda6a1af6181e23807117f1ea0b36e22834cd4d56947830d06eeb6d547ae63c1b21741dd28f0ac9e420679d232eb0caf092b7ac8999fe028b8df1db9202faf36d7e35bb50eaa454a4522cb80bc282b35dce7a5713505f401fdc308a5614e4f7e6c1ec7c293c1dc40da0d2e54a212cfb6f446eba8f6919c39f5a5f8eb79ec8c747e5bfc06fa50debd58de8fe062405f996129cfa7b019eb6dc75e4199cee2b5d804ce5a8204c2a16ed514ef6fa0bc8ee975b56773d4ab56ae57c506d8a3b0d16c81667844c9ff4ce901000000018706249b477a87fd6cee56172f6cff7d40d4fc485afbd104e4efe6a36581aeea",
		Witness: "000000070000000000000007000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000f3076648729e16682e59bb310e3115c000000000000000000000000000000000375f6dd36232599c000000000000000000000000000000000000000000000000000000000000000000000000686079db0000000000000000000000000000000051821737b443a12b30389dba503b606a00000000000000000000000000000000ac2f0480999cfd3c06913b0000000000000000000000000000000000000000000000000000000000000000006860ce58",
	})
	if err != nil {
		panic(err)
	}
	wit, err := plonk.ValueOfWitness[sw_bn254.ScalarField](proof.Witness)
	if err != nil {
		panic(err)
	}
	//00000000006118dd248d16df38fddc6fe8e1419dc0aa2113aee47a9b547cd8ee
	//00000000006118dd248d16df38fddc6fe8e1419dc0aa2113aee47a9b547cd8ee
	elems := wit.Public[timestamp.OffsetOutgoingHash : timestamp.OffsetOutgoingHash+timestamp.CountOutgoingHash]
	hash := getLinkedIdHash(elems)
	t.Logf("%x\n", hash)

}

func getEthRedeemCircuitFile(circuitDir string) (*btcproverCommon.CircuitFile, error) {
	ccsFile := filepath.Join(circuitDir, "redeem.ccs")
	vkFile := filepath.Join(circuitDir, "redeem.vk")

	ccs, vk, err := operations.ReadCcsAndVk(ccsFile, vkFile)
	if err != nil {
		log.Err(err)
		return nil, err
	}
	return &btcproverCommon.CircuitFile{
		Ccs:   ccs,
		Vkeys: []native_plonk.VerifyingKey{vk},
	}, nil
}
